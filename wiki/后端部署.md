## å†™åœ¨å‰é¢

ä¸ºäº†æ–¹ä¾¿å¤§å¤šæ•°äººä½¿ç”¨ï¼Œæ’ä»¶åç«¯åœ¨è®¾è®¡æ—¶å°½é‡åšåˆ°äº†ç®€å•å¹¶ä¸”å³å¼€å³ç”¨ï¼Œä½†æ˜¯éƒ¨ç½²è¿‡ç¨‹å¯èƒ½ä¾ç„¶éœ€è¦èŠ±è´¹å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œæ‰€ä»¥éœ€è¦è€å¿ƒå¾€ä¸‹çœ‹ã€‚

## åç«¯é¡¹ç›®

åç«¯é¡¹ç›®åä¸º`metatube-server`

äºŒè¿›åˆ¶æ–‡ä»¶å‘å¸ƒäºï¼š

- [GitHub Releases](https://github.com/metatube-community/metatube-server-releases/releases)

Dockeré•œåƒå‘å¸ƒäºï¼š

- [DockerHub](https://hub.docker.com/r/metatube/metatube-server)
- [GitHub Container Registry](https://github.com/metatube-community/metatube-sdk-go/pkgs/container/metatube-server)

> ç”±äº DockerHub çš„ä¸‹è½½é™åˆ¶ï¼Œå»ºè®®ä¼˜å…ˆé€‰æ‹©GitHub Container Registryä¸‹è½½é•œåƒã€‚

## å¦‚ä½•éƒ¨ç½²

> `metatube-server`èµ„æºå ç”¨éå¸¸ä½ï¼Œç†è®ºä¸Šä»»ä½•å†…å­˜>=128MBï¼Œç¡¬ç›˜>=2Gçš„æœºå™¨ï¼Œéƒ½å¯ä»¥ç›´æ¥è¿è¡ŒäºŒè¿›åˆ¶ç¨‹åºæˆ–è€…dockerå®¹å™¨ã€‚

### ç›´æ¥éƒ¨ç½²(â˜…â˜†â˜†)

1. ä»[Releases](https://github.com/metatube-community/metatube-server-releases/releases)ä¸‹è½½æœ€æ–°åç«¯ç¨‹åºã€‚
2. ä½¿ç”¨å¦‚ä¸‹**ä»»æ„æ¨¡å¼**å‘½ä»¤è¿è¡Œåç«¯ï¼š

- å†…å­˜æ¨¡å¼ï¼š`./metatube-server`
- æ•°æ®åº“æ¨¡å¼(æ¨è)ï¼š`./metatube-server -dsn metatube.db`

> Tipsï¼š
>
> - å¸¦`-v3`åç¼€çš„ç‰ˆæœ¬ç†è®ºä¸Šè¿è¡Œæ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯éœ€è¦æ–°ç‰ˆçš„CPUæ”¯æŒã€‚
> - Windowsä¸‹å¯ä»¥ç›´æ¥åŒå‡»è¿è¡Œï¼Œä½†æ˜¯ä»æ—§å»ºè®®ä½¿ç”¨æ•°æ®åº“æ¨¡å¼æŒä¹…åŒ–æ•°æ®ã€‚
> - é»˜è®¤ç«¯å£ä¸º8080ï¼Œè‹¥å‡ºç°ç«¯å£å ç”¨çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨`-port`å‚æ•°é…ç½®å…¶ä»–ç«¯å£ã€‚
> - Linuxä¸‹åå°è¿è¡Œåç«¯æœåŠ¡å¯ä»¥ä½¿ç”¨`nohup`ã€`systemd`ã€`Docker`ç­‰ã€‚
> - Windwosä¸‹åå°è¿è¡Œåç«¯æœåŠ¡å¯ä»¥ä½¿ç”¨[`NSSM`](https://nssm.cc/)ã€‚

### Dockeréƒ¨ç½²(â˜…â˜…â˜†)

> è¯·ç¡®ä¿éƒ¨ç½²å¹³å°å·²æœ‰Dockerç¯å¢ƒï¼Œå¦åˆ™è¯·å…ˆå®‰è£…[Docker](https://docs.docker.com/get-docker/)

ç›´æ¥è¿è¡Œä»¥ä¸‹ä»»æ„ä¸€æ¡å‘½ä»¤å³å¯ï¼š

- å†…å­˜æ¨¡å¼ï¼š

```sh
docker run -d -p 8080:8080 --name metatube metatube/metatube-server:latest
```

- æ•°æ®åº“æ¨¡å¼(æ¨è)ï¼š

```sh
docker run -d -p 8080:8080 -v $PWD/config:/config --name metatube metatube/metatube-server:latest -dsn /config/metatube.db
```

**æ›´æ–°åç«¯éœ€è¦å…ˆè¿è¡Œä»¥ä¸‹å‘½ä»¤å†é‡æ–°è·‘ä¸€éä¸Šè¿°å‘½ä»¤ï¼Œåˆæ¬¡å®‰è£…è¯·è·³è¿‡**

```sh
docker stop metatube
docker rm metatube
```

### Raspberry Piéƒ¨ç½²(â˜…â˜…â˜†)

~~éƒ½ç”¨æ ‘è“æ´¾äº†ï¼Œè·‘ä¸ªDockeråº”è¯¥ä¸éœ€è¦æ•™ç¨‹å§~~

### Synologyéƒ¨ç½²(â˜…â˜…â˜†)

å‚è€ƒï¼š[è¿™ç¯‡æ•™ç¨‹](https://www.baozhiqiang.xyz/index.php/archives/32/)

### Herokuéƒ¨ç½²(â˜…â˜…â˜†)

â€¼ï¸ Herokuä¸å†å…è´¹ï¼Œè¯·è½¬è‡³å…¶ä»–éƒ¨ç½²æ–¹å¼ï¼ˆå¦‚ï¼š[Koyebéƒ¨ç½²](#Koyebéƒ¨ç½²)ï¼‰

**ä¼˜åŠ¿ï¼š**

- ~~å…è´¹ğŸ†“~~ã€é€Ÿåº¦å¿«âš¡ï¸ã€ç®€å•éƒ¨ç½²+æ­å»ºä¸è¶…è¿‡ä¸‰åˆ†é’Ÿâ±ã€‚
- ä¸éœ€è¦ç»™åç«¯é…ç½®ä»£ç†ï¼Œä¸”ä½¿ç”¨ç¾å›½IPï¼Œåˆ®å‰Šé™åˆ¶å°‘ã€‚
- è‡ªåŠ¨æ”¯æŒHTTPSï¼Œå¯ä»¥é¿å…å¦‚Embyä¸‹å›¾ç‰‡åŠ è½½çš„é—®é¢˜ã€‚

è¯·çœ‹ï¼š[Herokuä¸€é”®éƒ¨ç½²](https://github.com/metatube-community/metatube-server-heroku)

### Koyebéƒ¨ç½²(â˜…â˜…â˜†)

**ä¼˜åŠ¿ï¼š**

- æ°¸ä¹…å…è´¹ğŸ†“ï¼ˆåªè¦ä¸å€’é—­ï¼‰ã€‚
- è‡ªåŠ¨æ”¯æŒHTTPSã€‚

è¯·çœ‹ï¼š[Koyebå¿«é€Ÿéƒ¨ç½²](https://github.com/metatube-community/metatube-server-koyeb)

## å‚æ•°é…ç½®

| **å‚æ•°å** | **å¯é€‰å€¼** | **é»˜è®¤å€¼** | **å¤‡æ³¨** |
| --------- | --------- | --------- | ------- |
| PORT | int<0-65535> | 8080 | ç›‘å¬ç«¯å£å·ï¼ŒæŒ‰éœ€ä¿®æ”¹ |
| TOKEN | string | _æ— _ | è®¿é—®å¯†é’¥ï¼ŒæŒ‰éœ€é…ç½®ï¼Œè‹¥éƒ¨ç½²åœ¨æœ¬åœ°åˆ™æ²¡æœ‰é…ç½®çš„å¿…è¦ |
| DSN | string | _å†…å­˜æ¨¡å¼_ | æ•°æ®åº“æœåŠ¡åœ°å€ï¼ŒæŒ‰éœ€é…ç½®ï¼Œå°ç™½å»ºè®®ä½¿ç”¨é»˜è®¤å€¼ |
| DB_MAX_IDLE_CONNS | int | 0 | æœ€å¤§ç©ºé—²æ•°æ®åº“è¿æ¥æ•°ï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤å€¼ |
| DB_MAX_OPEN_CONNS | int | 0 | æœ€å¤§æ•°æ®åº“è¿æ¥æ•°ï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤å€¼ |
| DB_PREPARED_STMT | bool | false | Prepared Statementï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤å€¼ |
| DB_AUTO_MIGRATE | bool | false | æ•°æ®åº“è¡¨è‡ªåŠ¨è¿ç§»ï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤å€¼ |
| REQUEST_TIMEOUT | string | 1m | è¯·æ±‚è¶…æ—¶æ—¶é•¿ï¼Œé»˜è®¤ä¸€åˆ†é’Ÿ |

### å…³äº`DSN`

- SQLite
  - å½“ä¼ å…¥çš„æ˜¯æ–‡ä»¶åï¼ˆå¦‚`library.db`ï¼‰ç­‰å­—ç¬¦ä¸²æ—¶ï¼Œåˆ™ä¼šä½¿ç”¨sqliteä½œä¸ºæ•°æ®åº“å¼•æ“ã€‚
  - é»˜è®¤ä½¿ç”¨`file::memory:?cache=shared`ä¸ºå‚æ•°çš„sqliteå†…å­˜æ¨¡å¼ï¼Œä½†æ˜¯æ•°æ®éæ°¸ä¹…ã€‚
- PostgresSQL
  - å¦‚æœä¼ å…¥çš„æ˜¯`^postgres(ql)?://`å¼€å¤´çš„é“¾æ¥ï¼Œåˆ™ä¼šä½¿ç”¨postgresä½œä¸ºæ•°æ®åº“å¼•æ“ã€‚

> DSN ç•™ç©ºæœåŠ¡ç«¯åˆ™ä¼šé»˜è®¤ä½¿ç”¨sqliteå†…å­˜æ¨¡å¼ï¼Œè¿™å½“ç„¶æ˜¯æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ã€‚ä½†æ˜¯å¦‚æœå…³é—­æœåŠ¡ç«¯ï¼Œé‚£ä¹ˆä¹‹å‰**æœåŠ¡ç«¯**çˆ¬å–ä»¥åŠä¿å­˜çš„æ‰€æœ‰æ•°æ®ä¹Ÿéƒ½ä¼šæ¶ˆå¤±ã€‚ï¼ˆJellyfin/Embyå·²ç»åˆ®å‰Šçš„æ•°æ®å½“ç„¶ä¸ä¼šæ¶ˆå¤±ï¼‰
>
> é…ç½® DSN åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åŠ å¿«åˆ®å‰Šé€Ÿåº¦ï¼Œæå‡ä½¿ç”¨ä½“éªŒï¼Œ**å»ºè®®æœ‰ä¸€å®šåŠ¨æ‰‹èƒ½åŠ›çš„ç”¨æˆ·ä½¿ç”¨**ã€‚

### å…³äº`DB_AUTO_MIGRATE`

è¯¥é€‰é¡¹ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®è¡¨ï¼Œ**ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶éœ€è¦å¼€å¯**ã€‚
